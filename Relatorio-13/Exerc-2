;;  Estrutura da criatura
(defstruct criatura
  nome
  ambiente
  periculosidade
  vida-media)

;; Catálogo inicial
(defparameter *catalogo*
  (list
    ;; Criaturas obrigatórias
    (make-criatura :nome "Safe Shallows Fish"
                   :ambiente "Safe Shallows"
                   :periculosidade "Baixa"
                   :vida-media 3)

    (make-criatura :nome "Reaper Leviathan"
                   :ambiente "Open Ocean"
                   :periculosidade "Alta"
                   :vida-media 25)

    ;; Duas criaturas Deep
    (make-criatura :nome "Ghost Leviathan Juvenile"
                   :ambiente "Deep"
                   :periculosidade "Alta"
                   :vida-media 40)

    (make-criatura :nome "Crab Squid"
                   :ambiente "Deep"
                   :periculosidade "Média"
                   :vida-media 15)))

;; HOF - Filtro de perigo
(defun filtra-por-perigo (catalogo)
  "Retorna apenas criaturas cuja periculosidade NÃO seja 'Baixa'."
  (remove-if (lambda (criatura)
               (string= (criatura-periculosidade criatura) "Baixa"))
             catalogo))

;; Relatório com mapcar (somente ambiente Deep)
(defun relatorio-profundidade (catalogo)
  "Retorna lista de strings para criaturas Deep no formato:
   '[NOME]: Vive em [AMBIENTE]'. Usa filtro antes de mapcar."
  (mapcar (lambda (c)
            (format nil "~a: Vive em ~a"
                    (criatura-nome c)
                    (criatura-ambiente c)))
          ;; filtro do ambiente
          (remove-if-not (lambda (c)
                           (string= (criatura-ambiente c) "Deep"))
                         catalogo)))

(format t "~%=== Teste: Filtrar criaturas PERIGOSAS ===~%")
(dolist (c (filtra-por-perigo *catalogo*))
  (format t "~a (~a)~%"
          (criatura-nome c)
          (criatura-periculosidade c)))

(format t "~%=== Relatório: Criaturas do ambiente DEEP ===~%")
(dolist (linha (relatorio-profundidade *catalogo*))
  (format t "~a~%" linha))
